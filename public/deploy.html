<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GIFTED-MD Deployment</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #667eea; padding: 20px; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; }
        h1 { color: #333; margin-bottom: 20px; }
        textarea { width: 100%; padding: 10px; margin-bottom: 10px; }
        button { padding: 10px 20px; background: #4CAF50; color: white; border: none; cursor: pointer; }
        button:disabled { background: #ccc; }
        #status { margin-top: 20px; padding: 10px; background: #f0f0f0; border-radius: 5px; }
        .error { color: red; }
        .success { color: green; }
    </style>
</head>
<body>
    <div class="container">
        <h1>GIFTED-MD Deployment</h1>
        <p>Paste your WhatsApp session ID below:</p>
        <textarea id="sessionId" placeholder="Gifted~..." rows="5"></textarea>
        <button onclick="deployBot()" id="deployBtn">üöÄ Deploy Bot</button>
        <button onclick="stopBot()" id="stopBtn">‚èπÔ∏è Stop Bot</button>
        
        <div id="status">
            <strong>Status:</strong> <span id="statusText">Loading...</span>
        </div>
        
        <div id="message" style="margin-top: 10px;"></div>
    </div>

    <script>
        async function updateStatus() {
            try {
                const response = await fetch('/api/status');
                const data = await response.json();
                
                document.getElementById('statusText').textContent = 
                    data.botConnected ? 'Bot Connected ‚úÖ' : 
                    data.sessionExists ? 'Session Ready ‚è≥' : 
                    'Waiting for Deployment ‚è≥';
                
                document.getElementById('deployBtn').disabled = data.botConnected;
                document.getElementById('stopBtn').disabled = !data.botConnected;
                
            } catch (error) {
                document.getElementById('statusText').textContent = 'Error loading status';
            }
        }
        
        async function deployBot() {
            const sessionId = document.getElementById('sessionId').value.trim();
            
            if (!sessionId) {
                showMessage('Please enter a session ID', 'error');
                return;
            }
            
            if (!sessionId.startsWith('Gifted~')) {
                showMessage('Invalid session format. Must start with Gifted~', 'error');
                return;
            }
            
            document.getElementById('deployBtn').disabled = true;
            showMessage('Deploying...', '');
            
            try {
                const response = await fetch('/api/deploy', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ sessionId: sessionId })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showMessage(data.message || 'Deployment successful!', 'success');
                    setTimeout(updateStatus, 2000);
                } else {
                    showMessage(data.message || 'Deployment failed', 'error');
                }
                
            } catch (error) {
                showMessage('Deployment failed: ' + error.message, 'error');
            } finally {
                document.getElementById('deployBtn').disabled = false;
            }
        }
        
        async function stopBot() {
            document.getElementById('stopBtn').disabled = true;
            
            try {
                const response = await fetch('/api/stop', {
                    method: 'POST'
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showMessage(data.message || 'Bot stopped', 'success');
                    setTimeout(updateStatus, 1000);
                } else {
                    showMessage(data.message || 'Failed to stop bot', 'error');
                }
                
            } catch (error) {
                showMessage('Error: ' + error.message, 'error');
            } finally {
                document.getElementById('stopBtn').disabled = false;
            }
        }
        
        function showMessage(text, type) {
            const el = document.getElementById('message');
            el.textContent = text;
            el.className = type;
        }
        
        // Initial load
        updateStatus();
        // Update every 3 seconds
        setInterval(updateStatus, 3000);
    </script>
</body>
</html>
